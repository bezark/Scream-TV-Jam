[gd_scene load_steps=16 format=3 uid="uid://bseken28keq43"]

[ext_resource type="Script" path="res://Characters/living_tv.gd" id="1_ht7ep"]
[ext_resource type="ArrayMesh" uid="uid://inyrjlajiagb" path="res://assets/Comp.res" id="1_iww6c"]
[ext_resource type="Texture2D" uid="uid://dks8dj0wdf2mn" path="res://assets/Texture/TV_03.jpg" id="2_2pox0"]
[ext_resource type="VideoStream" path="res://assets/cooks short.ogv" id="4_m7878"]
[ext_resource type="Script" path="res://FSM/StateMachine.gd" id="4_x6g53"]
[ext_resource type="Script" path="res://FSM/TVStates/happy_broadcast.gd" id="6_d2b1o"]
[ext_resource type="Script" path="res://FSM/TVStates/anxious.gd" id="7_01ha7"]
[ext_resource type="Script" path="res://FSM/TVStates/move_to.gd" id="8_8f1b2"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_7ura5"]
albedo_texture = ExtResource("2_2pox0")

[sub_resource type="ViewportTexture" id="ViewportTexture_ehnd4"]
viewport_path = NodePath("Content/Images")

[sub_resource type="ViewportTexture" id="ViewportTexture_0mqyk"]
viewport_path = NodePath("Content/Images")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_hpg6i"]
resource_local_to_scene = true
albedo_texture = SubResource("ViewportTexture_ehnd4")
emission_enabled = true
emission_texture = SubResource("ViewportTexture_0mqyk")

[sub_resource type="BoxShape3D" id="BoxShape3D_egpmn"]
size = Vector3(1.14062, 1.18628, 1.03625)

[sub_resource type="ViewportTexture" id="ViewportTexture_jxkkm"]
viewport_path = NodePath("Content/Images")

[sub_resource type="CylinderShape3D" id="CylinderShape3D_kegae"]
height = 6.74173
radius = 15.0

[node name="TV" type="CharacterBody3D"]
script = ExtResource("1_ht7ep")

[node name="NavAgent" type="NavigationAgent3D" parent="."]
target_desired_distance = 3.0
avoidance_enabled = true
radius = 1.0
debug_use_custom = true
debug_path_custom_color = Color(1, 1, 0, 1)

[node name="Mesh" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
mesh = ExtResource("1_iww6c")
skeleton = NodePath("../..")
surface_material_override/0 = SubResource("StandardMaterial3D_7ura5")
surface_material_override/1 = SubResource("StandardMaterial3D_hpg6i")

[node name="CollisionShape3D2" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.00585938, 0.481323, 0.0181274)
shape = SubResource("BoxShape3D_egpmn")

[node name="Content" type="Node3D" parent="."]

[node name="Images" type="SubViewport" parent="Content"]
canvas_item_default_texture_filter = 0
size = Vector2i(532, 300)
size_2d_override_stretch = true

[node name="ColorRect" type="ColorRect" parent="Content/Images"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="VideoStreamPlayer" type="VideoStreamPlayer" parent="Content/Images/ColorRect"]
texture_filter = 1
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -6.0
offset_top = -2.0
offset_right = 498.0
offset_bottom = 262.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 3
size_flags_vertical = 3
stream = ExtResource("4_m7878")
volume_db = -80.0
autoplay = true

[node name="AudioStreamPlayer3D" type="AudioStreamPlayer3D" parent="Content"]
autoplay = true

[node name="Beam" type="SpotLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.347375, 0)
light_color = Color(0.627451, 1, 1, 1)
light_energy = 16.0
light_indirect_energy = 0.0
light_projector = SubResource("ViewportTexture_jxkkm")
light_size = 1.0
shadow_enabled = true
spot_range = 7.08239
spot_angle = 30.5856

[node name="Senses" type="Node3D" parent="."]

[node name="Visibile" type="VisibleOnScreenNotifier3D" parent="Senses"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
aabb = AABB(-1, -1, -1, 2, 1.5, 2)

[node name="Area" type="Area3D" parent="Senses"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Senses/Area"]
shape = SubResource("CylinderShape3D_kegae")

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("4_x6g53")
initial_state = NodePath("happy_broadcast")

[node name="happy_broadcast" type="Node" parent="StateMachine" node_paths=PackedStringArray("character")]
script = ExtResource("6_d2b1o")
character = NodePath("../..")

[node name="anxious" type="Node" parent="StateMachine" node_paths=PackedStringArray("character")]
script = ExtResource("7_01ha7")
character = NodePath("../..")

[node name="move_to" type="Node" parent="StateMachine" node_paths=PackedStringArray("character")]
script = ExtResource("8_8f1b2")
character = NodePath("../..")

[connection signal="velocity_computed" from="NavAgent" to="StateMachine/move_to" method="_on_nav_agent_velocity_computed"]
[connection signal="screen_entered" from="Senses/Visibile" to="StateMachine/move_to" method="_on_visibile_screen_entered"]
[connection signal="screen_exited" from="Senses/Visibile" to="StateMachine/move_to" method="_on_visibile_screen_exited"]
[connection signal="body_entered" from="Senses/Area" to="." method="_on_area_body_entered"]
[connection signal="body_entered" from="Senses/Area" to="StateMachine/anxious" method="_on_area_body_entered"]
[connection signal="body_exited" from="Senses/Area" to="." method="_on_area_body_exited"]
[connection signal="body_exited" from="Senses/Area" to="StateMachine/happy_broadcast" method="_on_area_body_exited"]
